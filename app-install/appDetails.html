<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8">
Â  <title>App Details</title>
Â  <link rel="stylesheet" href="assets/style.css">
</head>
<body class="terminal-background">
Â  <div id="appDetails" class="modal-content" style="margin: 5% auto;">
Â  Â  <div class="modal-header">
Â  Â  Â  <h2 id="appName" class="glitch-text" data-text="App Name Here">App Name Here</h2>
Â  Â  </div>

Â  Â  <div class="modal-body">
Â  Â  Â  <!-- New element to display the full description -->
Â  Â  Â  <p id="appDescription" style="margin-bottom: 20px;"></p>

Â  Â  Â  <div style="margin-bottom: 20px;">
Â  Â  Â  Â  <button id="likeBtn" class="action-button">
Â  Â  Â  Â  Â  <span class="button-icon">ğŸ‘</span>
Â  Â  Â  Â  Â  Like (<span id="likeCount">0</span>)
Â  Â  Â  Â  </button>
Â  Â  Â  </div>

Â  Â  Â  <div>
Â  Â  Â  Â  <h3 class="typewriter" style="margin-bottom: 10px;">Comments</h3>
Â  Â  Â  Â  <ul id="commentList" style="margin-bottom: 20px;"></ul>
Â  Â  Â  Â  <form id="commentForm">
Â  Â  Â  Â  Â  <textarea name="comment" class="form-input" rows="4" required placeholder="Enter a comment" style="margin-bottom: 10px;"></textarea>
Â  Â  Â  Â  Â  <button type="submit" class="action-button">
Â  Â  Â  Â  Â  Â  <span class="button-icon">ğŸ’¬</span>
Â  Â  Â  Â  Â  Â  Submit Comment
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </form>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <script>
Â  Â  const API_URL = 'http://localhost:3000/api';
Â  Â  const likeBtn = document.getElementById('likeBtn');
Â  Â  const likeCountElem = document.getElementById('likeCount');
Â  Â  const commentForm = document.getElementById('commentForm');
Â  Â  const commentList = document.getElementById('commentList');
Â  Â  const appNameElem = document.getElementById('appName');
Â  Â  const appDescriptionElem = document.getElementById('appDescription');

Â  Â  function getQueryParam(param) {
Â  Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  return urlParams.get(param);
Â  Â  }

Â  Â  const appUuid = getQueryParam('uuid');
Â  Â  if (!appUuid) {
Â  Â  Â  alert('No app UUID provided in the URL.');
Â  Â  } else {
Â  Â  Â  likeBtn.setAttribute('data-uuid', appUuid);
Â  Â  }

Â  Â  let userHasLiked = false; // Track if the user has already liked the app

Â  Â  likeBtn.addEventListener('click', async () => {
Â  Â  Â  if (userHasLiked) {
Â  Â  Â  Â  alert("You have already liked this app!");
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch(`${API_URL}/apps/${appUuid}/like`, { method: 'POST' });
Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  likeCountElem.textContent = data.likes;
Â  Â  Â  Â  userHasLiked = true;
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error('Error liking app:', error);
Â  Â  Â  }
Â  Â  });

Â  Â  commentForm.addEventListener('submit', async (e) => {
Â  Â  Â  e.preventDefault();
Â  Â  Â  const commentText = commentForm.elements.comment.value;
Â  Â  Â  const payload = {
Â  Â  Â  Â  text: commentText,
Â  Â  Â  Â  userId: (window.currentUser && window.currentUser.id) || 'anonymous',
Â  Â  Â  Â  username: (window.currentUser && window.currentUser.username) || 'Anonymous'
Â  Â  Â  };

Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch(`${API_URL}/apps/${appUuid}/comment`, {
Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  body: JSON.stringify(payload)
Â  Â  Â  Â  });
Â  Â  Â  Â  const comment = await res.json();
Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  li.textContent = `${comment.username}: ${comment.text}`;
Â  Â  Â  Â  commentList.appendChild(li);
Â  Â  Â  Â  commentForm.reset();
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error('Error posting comment:', error);
Â  Â  Â  }
Â  Â  });

Â  Â  async function loadAppDetails() {
Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch(`${API_URL}/apps`);
Â  Â  Â  Â  const apps = await res.json();
Â  Â  Â  Â  const app = apps.find(a => a.uuid === appUuid);
Â  Â  Â  Â  if (app) {
Â  Â  Â  Â  Â  appNameElem.textContent = app.name;
Â  Â  Â  Â  Â  appNameElem.setAttribute('data-text', app.name);
Â  Â  Â  Â  Â  likeCountElem.textContent = app.likes;
Â  Â  Â  Â  Â  // Set the complete description
Â  Â  Â  Â  Â  appDescriptionElem.textContent = app.description || 'No description available.';

Â  Â  Â  Â  Â  if (app.comments && app.comments.length > 0) {
Â  Â  Â  Â  Â  Â  app.comments.forEach(comment => {
Â  Â  Â  Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  Â  Â  Â  li.textContent = `${comment.username}: ${comment.text}`;
Â  Â  Â  Â  Â  Â  Â  commentList.appendChild(li);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  console.error('App not found');
Â  Â  Â  Â  }
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error('Error loading app details:', error);
Â  Â  Â  }
Â  Â  }

Â  Â  loadAppDetails();
Â  </script>
</body>
</html>
